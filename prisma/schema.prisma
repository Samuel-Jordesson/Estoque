// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Modelo para dados da empresa
model Empresa {
  id          Int      @id @default(autoincrement())
  nomeEmpresa String
  cnpj        String   @unique
  cpf         String?
  email       String
  telefone    String
  endereco    String
  bairro      String
  cidade      String
  estado      String
  cep         String
  responsavel String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relacionamentos
  usuarios      Usuario[]
  categorias    Categoria[]
  produtos      Produto[]
  movimentacoes Movimentacao[]

  @@map("empresa")
}

// Modelo para usuários do sistema
model Usuario {
  id                Int      @id @default(autoincrement())
  nome              String
  email             String   @unique
  telefone          String
  cargo             String
  senha             String
  status            String   @default("ativo") // ativo, inativo
  produtosRetirados Int      @default(0)
  ultimaAtividade   DateTime @default(now())
  dataCadastro      DateTime @default(now())
  empresaId         Int
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relacionamentos
  empresa       Empresa        @relation(fields: [empresaId], references: [id])
  movimentacoes Movimentacao[]

  @@map("usuarios")
}

// Modelo para categorias de produtos
model Categoria {
  id          Int      @id @default(autoincrement())
  nome        String
  descricao   String?
  empresaId   Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relacionamentos
  empresa  Empresa  @relation(fields: [empresaId], references: [id])
  produtos Produto[]

  @@unique([nome, empresaId])
  @@map("categorias")
}

// Modelo para produtos
model Produto {
  id          Int      @id @default(autoincrement())
  nome        String
  descricao   String?
  categoriaId Int
  empresaId   Int
  preco       Float
  quantidade  Int      @default(0)
  quantidadeMinima Int @default(0)
  lastUpdated DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relacionamentos
  empresa       Empresa        @relation(fields: [empresaId], references: [id])
  categoria     Categoria      @relation(fields: [categoriaId], references: [id])
  movimentacoes Movimentacao[]

  @@map("produtos")
}

// Modelo para movimentações de estoque
model Movimentacao {
  id        Int      @id @default(autoincrement())
  produtoId Int
  usuarioId Int
  empresaId Int
  tipo      String   // entrada, saida
  quantidade Int
  preco     Float
  observacoes String?
  data      DateTime @default(now())
  createdAt DateTime @default(now())

  // Relacionamentos
  empresa  Empresa  @relation(fields: [empresaId], references: [id])
  produto  Produto  @relation(fields: [produtoId], references: [id])
  usuario  Usuario  @relation(fields: [usuarioId], references: [id])

  @@map("movimentacoes")
}

// Modelo para configurações do sistema
model Configuracao {
  id    Int    @id @default(autoincrement())
  chave String @unique
  valor String
  descricao String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("configuracoes")
}
